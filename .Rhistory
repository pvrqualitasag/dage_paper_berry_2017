qrmdtmpl::draft_qbdpdf2(ps_path = "20220119_paper_q_and_a", pl_repl_value = list(title = "DAGE Paper Q and A", author = "Peter von Rohr"))
qrmdtmpl::draft_qemptydoc(ps_path = "20220119_data_example_nb", pl_repl_value = list(title = "Example Data for DAGE", author = "Peter von Rohr", output_format = "html_notebook"))
rnorm(4)
abs(rnorm(4))
-abs(rnorm(4))
c(-abs(rnorm(2)), 0, abs(rnorm(2)))
?sort
c(sort(-abs(rnorm(2))), 0, sort(abs(rnorm(2))))
c(sort(-abs(rnorm(2))), 0, sort(abs(rnorm(2))))
knitr::opts_chunk$set(echo = TRUE)
tbl_effects <- tibble::tibble(Effect = c("CG", "",
"GENDER|CWT", "", "",
"GENDER|CFAT", "", "", "", "",
, "", "", "", "", "",
, "", "", "", "", ""),
Level  = c("1", "2",
"1", "2", "3",
"1|1", "1|2", "1|3", "1|4", "1|5",
"2|1", "2|2", "2|3", "2|4", "2|5",
"3|1", "3|2", "3|3", "3|4", "3|5"),
Effectsize = c(-5, 17,
1.08, 1.31, 0.93,
-0.7, -0.6, 0, 0.7, 1.1,
-0.2, -0.2, 0, 0.3, 1.8,
-0.7, -0.5, 0, 0.8, 0.9))
knitr::opts_chunk$set(echo = TRUE)
tbl_effects <- tibble::tibble(Effect = c("CG", "",
"GENDER|CWT", "", "",
"GENDER|CFAT", "", "", "", "",
"", "", "", "", "",
"", "", "", "", ""),
Level  = c("1", "2",
"1", "2", "3",
"1|1", "1|2", "1|3", "1|4", "1|5",
"2|1", "2|2", "2|3", "2|4", "2|5",
"3|1", "3|2", "3|3", "3|4", "3|5"),
Effectsize = c(-5, 17,
1.08, 1.31, 0.93,
-0.7, -0.6, 0, 0.7, 1.1,
-0.2, -0.2, 0, 0.3, 1.8,
-0.7, -0.5, 0, 0.8, 0.9))
knitr::kable(tbl_effects)
as.character(1:5)
paste0(as.character(1:5), collapse = ", ")
paste0(as.character(1:5), collapse = '", "')
paste0(as.character(1:5), collapse = "', '")
paste0("'", paste0(as.character(1:5), collapse = '", "'), "'", collapse = "")
paste0("'", paste0(as.character(1:5), collapse = "', '"), "'", collapse = "")
?outer
vec_levels_sex <- c("1", "2", "3")
vec_levels_cfat <- c('1', '2', '3', '4', '5')
outer(vec_levels_sex, vec_levels_cfat, FUN = paste0, collapse = "|")
x <- 1:9; names(x) <- x
x
x %o% x
month.abb
outer(month.abb, 1999:2003, FUN = "paste")
outer(vec_levels_sex, vec_levels_cfat, FUN = "paste0", collapse = "|")
vec_levels_sex
vec_levels_cfat
outer(vec_levels_cfat, vec_levels_sex, FUN = "paste")
outer(vec_levels_cfat, vec_levels_sex, FUN = "paste0", collapse = "|")
outer(vec_levels_cfat, vec_levels_sex, FUN = "paste0")
t(outer(vec_levels_cfat, vec_levels_sex, FUN = "paste0"))
outer(vec_levels_sex, vec_levels_cfat, FUN = "paste0")
outer(sapply(vec_levels_sex, function(x) paste0(x, "|", collapse = ""), USE.NAMES = FALSE), vec_levels_cfat, FUN = "paste0")
?flatten
mat_levels_cfat_sex <- outer(sapply(vec_levels_sex,
function(x) paste0(x, "|", collapse = ""),
USE.NAMES = FALSE),
vec_levels_cfat,
FUN = "paste0")
mat_levels_cfat_sex
as.vector(mat_levels_cfat_sex)
paste0("'", paste0(as.vector(mat_levels_cfat_sex), collapse = "', '"), "'", collapse = "")
paste0("'", paste0(as.vector(t(mat_levels_cfat_sex)), collapse = "', '"), "'", collapse = "")
knitr::opts_chunk$set(echo = TRUE)
vec_levels_cg <- c("1", "2")
vec_levels_sex <- c("1", "2", "3")
# produce vector for table below
#paste0("'", paste0(as.character(1:5), collapse = "', '"), "'", collapse = "")
vec_levels_cfat <- c('1', '2', '3', '4', '5')
mat_levels_cfat_sex <- outer(sapply(vec_levels_sex,
function(x) paste0(x, "|", collapse = ""),
USE.NAMES = FALSE),
vec_levels_cfat,
FUN = "paste0")
# produce cfat levels
# paste0("'", paste0(as.vector(t(mat_levels_cfat_sex)), collapse = "', '"), "'", collapse = "")
tbl_effects <- tibble::tibble(Effect = c("CG", "",
"GENDER|CWT", "", "",
"GENDER|CFAT", "", "", "", "",
"", "", "", "", "",
"", "", "", "", ""),
Level  = c("1", "2",
"1", "2", "3",
'1|1', '1|2', '1|3', '1|4', '1|5',
'2|1', '2|2', '2|3', '2|4', '2|5',
'3|1', '3|2', '3|3', '3|4', '3|5'),
Effectsize = c(-5, 17,
1.08, 1.31, 0.93,
-0.7, -0.6, 0, 0.7, 1.1,
-0.2, -0.2, 0, 0.3, 1.8,
-0.7, -0.5, 0, 0.8, 0.9))
knitr::kable(tbl_effects)
?sample
vec_levels_cg <- c("1", "2")
sample(vec_levels_cg, 10, replace = TRUE)
knitr::opts_chunk$set(echo = TRUE)
vec_levels_cg <- c("1", "2")
vec_levels_sex <- c("1", "2", "3")
# produce vector for table below
#paste0("'", paste0(as.character(1:5), collapse = "', '"), "'", collapse = "")
vec_levels_cfat <- c('1', '2', '3', '4', '5')
mat_levels_cfat_sex <- outer(sapply(vec_levels_sex,
function(x) paste0(x, "|", collapse = ""),
USE.NAMES = FALSE),
vec_levels_cfat,
FUN = "paste0")
# produce cfat levels
# paste0("'", paste0(as.vector(t(mat_levels_cfat_sex)), collapse = "', '"), "'", collapse = "")
tbl_effects <- tibble::tibble(Effect = c("CG", "",
"GENDER|CWT", "", "",
"GENDER|CFAT", "", "", "", "",
"", "", "", "", "",
"", "", "", "", ""),
Level  = c("1", "2",
"1", "2", "3",
'1|1', '1|2', '1|3', '1|4', '1|5',
'2|1', '2|2', '2|3', '2|4', '2|5',
'3|1', '3|2', '3|3', '3|4', '3|5'),
Effectsize = c(-5, 17,
1.08, 1.31, 0.93,
-0.7, -0.6, 0, 0.7, 1.1,
-0.2, -0.2, 0, 0.3, 1.8,
-0.7, -0.5, 0, 0.8, 0.9))
knitr::kable(tbl_effects)
set.seed(9192)
n_nr_animal <- 10
tbl_dage_data <- tibble::tibble(
AnimalID = c(1:n_nr_animal),
CG = sample(vec_levels_cg, n_nr_animal, replace = TRUE),
GENDER = sample(vec_levels_sex, n_nr_animal, replace = TRUE),
CWT = rnorm(n_nr_animal, mean = 354, sd = 28.1)
)
knitr::kable(tbl_dage_data)
lm_cwt <- lm(CWT ~ 0 + CG, data = tbl_dage_data)
model.matrix(lm_cwt)
# model matrix for cg
model_mat_cg <- model.matrix(lm(CWT ~ 0 + CG, data = tbl_dage_data))
attributes(model_mat_cg)
attributes(model_mat_cg) <- NULL
model_mat_cg
attributes(model_mat_cg)$contrasts <- NULL
# model matrix for cg
model_mat_cg <- model.matrix(lm(CWT ~ 0 + CG, data = tbl_dage_data))
attributes(model_mat_cg)$contrasts <- NULL
model_mat_cg
attributes(model_mat_cg)$assign <- NULL
model_mat_cg
# vector of cg effects
vec_effect_size_cg <- tbl_effects$Effectsize[1:2]
crossprod(t(model_mat_cg), vec_effect_size_cg)
model_mat_gender <- model.matrix(lm(CWT ~ 0 + GENDER, data = tbl_dage_data))
attributes(model_mat_gender)$contrasts <- NULL
attributes(model_mat_gender)$assign <- NULL
model_mat_gender
# vec of GENDER|CWT regression coefficients
vec_effect_size_gender <- tbl_effects$Effectsize[3:5]
crossprod(t(model_mat_gender), vec_effect_size_gender)
crossprod(t(model_mat_gender), vec_effect_size_gender) * tbl_dage_data$CWT
model_mat_gender
# model matrix for GENDER|CFAT
model_mat_cfat <- model.matrix(lm(CWT ~ 0 + GENDER|CFAT, data = tbl_dage_data))
set.seed(9192)
n_nr_animal <- 10
tbl_dage_data <- tibble::tibble(
AnimalID = c(1:n_nr_animal),
CG = sample(vec_levels_cg, n_nr_animal, replace = TRUE),
GENDER = sample(vec_levels_sex, n_nr_animal, replace = TRUE),
CFAT = sample(vec_levels_cfat, n_nr_animal, replace = TRUE),
CWT = rnorm(n_nr_animal, mean = 354, sd = 28.1)
)
knitr::kable(tbl_dage_data)
# model matrix for GENDER|CFAT
model_mat_cfat <- model.matrix(lm(CWT ~ 0 + GENDER|CFAT, data = tbl_dage_data))
# model matrix for GENDER|CFAT
model_mat_cfat <- model.matrix(lm(CWT ~ GENDER|CFAT, data = tbl_dage_data))
library(dplyr)
tbl_dage_data %>% mutate(GENDER_CFAT = paste0(GENDER, CFAT, collapse = "|"))
tbl_dage_data %>% mutate(GENDER_CFAT = paste0(GENDER, CFAT, collapse = "|"))
?dplyr::across
?dplyr::mutate
?dplyr::across
tbl_dage_data %>% mutate(across(.cols = c("GENDER", "CFAT"), .fns = paste0))
tbl_dage_data %>% mutate(across(.cols = c(GENDER, CFAT), .fns = "paste0"))
tbl_dage_data %>% mutate(across(c(GENDER, CFAT), paste0))
tbl_dage_data %>% mutate(across(c(GENDER, CFAT), "paste0"))
tbl_dage_data %>% mutate(across(c(GENDER, CFAT), paste0))
iris %>%
as_tibble() %>%
mutate(across(1:Sepal.Width, round))
iris
tbl_dage_data$GENDER_CFAT <- sapply(1:nrow(tbl_dage_data), function(x) paste0(tbl_dage_data$GENDER[x], tbl_dage_data$CFAT[x], collapse = "|"), USE.NAMES = FALSE)
tbl_dage_data
tbl_dage_data$GENDER_CFAT <- sapply(1:nrow(tbl_dage_data), function(x) paste(tbl_dage_data$GENDER[x], tbl_dage_data$CFAT[x], sep = "|"), USE.NAMES = FALSE)
tbl_dage_data
tbl_dage_data$GENDER_CFAT <- sapply(1:nrow(tbl_dage_data), function(x) paste(tbl_dage_data$GENDER[x], tbl_dage_data$CFAT[x], sep = "|"), USE.NAMES = FALSE)
model_mat_cfat <- model.matrix(lm(CWT ~ GENDER_CFAT, data = tbl_dage_data))
attributes(model_mat_cfat)$contrasts <- NULL
attributes(model_mat_cfat)$assign <- NULL
model_mat_cfat
model_mat_cfat <- model.matrix(lm(CWT ~ 0 + GENDER_CFAT, data = tbl_dage_data))
attributes(model_mat_cfat)$contrasts <- NULL
attributes(model_mat_cfat)$assign <- NULL
model_mat_cfat
